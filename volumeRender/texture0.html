
<!-- saved from url=(0052)http://learningwebgl.com/lessons/lesson15/index.html -->
<html><body><div class="webkit-line-gutter-backdrop"></div><table><tbody><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;head&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;title&gt;</span>Learning WebGL &amp;mdash; lesson 15<span class="webkit-html-tag">&lt;/title&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;meta <span class="webkit-html-attribute-name">http-equiv</span>="<span class="webkit-html-attribute-value">content-type</span>" <span class="webkit-html-attribute-name">content</span>="<span class="webkit-html-attribute-value">text/html; charset=ISO-8859-1</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/javascript</span>" <span class="webkit-html-attribute-name">src</span>="<a class="webkit-html-attribute-value webkit-html-resource-link" target="_blank" href="http://learningwebgl.com/lessons/lesson15/glMatrix-0.9.5.min.js">glMatrix-0.9.5.min.js</a>"&gt;</span><span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/javascript</span>" <span class="webkit-html-attribute-name">src</span>="<a class="webkit-html-attribute-value webkit-html-resource-link" target="_blank" href="http://learningwebgl.com/lessons/lesson15/webgl-utils.js">webgl-utils.js</a>"&gt;</span><span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">per-fragment-lighting-fs</span>" <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">x-shader/x-fragment</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    precision mediump float;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    varying vec2 vTextureCoord;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    varying vec3 vTransformedNormal;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    varying vec4 vPosition;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform bool uUseColorMap;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform bool uUseSpecularMap;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform bool uUseLighting;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform vec3 uAmbientColor;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform vec3 uPointLightingLocation;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform vec3 uPointLightingSpecularColor;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform vec3 uPointLightingDiffuseColor;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform sampler2D uColorMapSampler;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform sampler2D uSpecularMapSampler;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    void main(void) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        vec3 lightWeighting;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (!uUseLighting) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            lightWeighting = vec3(1.0, 1.0, 1.0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        } else {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            vec3 lightDirection = normalize(uPointLightingLocation - vPosition.xyz);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            vec3 normal = normalize(vTransformedNormal);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            float specularLightWeighting = 0.0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            float shininess = 32.0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (uUseSpecularMap) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                shininess = texture2D(uSpecularMapSampler, vec2(vTextureCoord.s, vTextureCoord.t)).r * 255.0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (shininess &lt; 255.0) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                vec3 eyeDirection = normalize(-vPosition.xyz);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                vec3 reflectionDirection = reflect(-lightDirection, normal);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            float diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            lightWeighting = uAmbientColor</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                + uPointLightingSpecularColor * specularLightWeighting</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                + uPointLightingDiffuseColor * diffuseLightWeighting;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        vec4 fragmentColor;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (uUseColorMap) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            fragmentColor = texture2D(uColorMapSampler, vec2(vTextureCoord.s, vTextureCoord.t));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        } else {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            fragmentColor = vec4(1.0, 1.0, 1.0, 1.0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl_FragColor = vec4(fragmentColor.rgb * lightWeighting, fragmentColor.a);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">per-fragment-lighting-vs</span>" <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">x-shader/x-vertex</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    attribute vec3 aVertexPosition;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    attribute vec3 aVertexNormal;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    attribute vec2 aTextureCoord;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform mat4 uMVMatrix;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform mat4 uPMatrix;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    uniform mat3 uNMatrix;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    varying vec2 vTextureCoord;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    varying vec3 vTransformedNormal;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    varying vec4 vPosition;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    void main(void) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        vPosition = uMVMatrix * vec4(aVertexPosition, 1.0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl_Position = uPMatrix * vPosition;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        vTextureCoord = aTextureCoord;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        vTransformedNormal = uNMatrix * aVertexNormal;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/javascript</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var gl;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function initGL(canvas) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        try {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            gl = canvas.getContext("experimental-webgl");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            gl.viewportWidth = canvas.width;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            gl.viewportHeight = canvas.height;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        } catch (e) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (!gl) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            alert("Could not initialise WebGL, sorry :-(");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function getShader(gl, id) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var shaderScript = document.getElementById(id);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (!shaderScript) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var str = "";</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var k = shaderScript.firstChild;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        while (k) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (k.nodeType == 3) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                str += k.textContent;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            k = k.nextSibling;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var shader;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (shaderScript.type == "x-shader/x-fragment") {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            shader = gl.createShader(gl.FRAGMENT_SHADER);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        } else if (shaderScript.type == "x-shader/x-vertex") {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            shader = gl.createShader(gl.VERTEX_SHADER);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        } else {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.shaderSource(shader, str);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.compileShader(shader);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            alert(gl.getShaderInfoLog(shader));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return shader;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var shaderProgram;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function initShaders() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var fragmentShader = getShader(gl, "per-fragment-lighting-fs");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var vertexShader = getShader(gl, "per-fragment-lighting-vs");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram = gl.createProgram();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.attachShader(shaderProgram, vertexShader);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.attachShader(shaderProgram, fragmentShader);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.linkProgram(shaderProgram);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            alert("Could not initialise shaders");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.useProgram(shaderProgram);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.vertexNormalAttribute = gl.getAttribLocation(shaderProgram, "aVertexNormal");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.enableVertexAttribArray(shaderProgram.vertexNormalAttribute);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.textureCoordAttribute = gl.getAttribLocation(shaderProgram, "aTextureCoord");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.pMatrixUniform = gl.getUniformLocation(shaderProgram, "uPMatrix");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.mvMatrixUniform = gl.getUniformLocation(shaderProgram, "uMVMatrix");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.nMatrixUniform = gl.getUniformLocation(shaderProgram, "uNMatrix");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.colorMapSamplerUniform = gl.getUniformLocation(shaderProgram, "uColorMapSampler");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.specularMapSamplerUniform = gl.getUniformLocation(shaderProgram, "uSpecularMapSampler");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.useColorMapUniform = gl.getUniformLocation(shaderProgram, "uUseColorMap");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.useSpecularMapUniform = gl.getUniformLocation(shaderProgram, "uUseSpecularMap");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.useLightingUniform = gl.getUniformLocation(shaderProgram, "uUseLighting");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.ambientColorUniform = gl.getUniformLocation(shaderProgram, "uAmbientColor");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.pointLightingLocationUniform = gl.getUniformLocation(shaderProgram, "uPointLightingLocation");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.pointLightingSpecularColorUniform = gl.getUniformLocation(shaderProgram, "uPointLightingSpecularColor");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        shaderProgram.pointLightingDiffuseColorUniform = gl.getUniformLocation(shaderProgram, "uPointLightingDiffuseColor");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function handleLoadedTexture(texture) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindTexture(gl.TEXTURE_2D, texture);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texture.image);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.generateMipmap(gl.TEXTURE_2D);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindTexture(gl.TEXTURE_2D, null);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var earthColorMapTexture;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var earthSpecularMapTexture;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function initTextures() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        earthColorMapTexture = gl.createTexture();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        earthColorMapTexture.image = new Image();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        earthColorMapTexture.image.onload = function () {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            handleLoadedTexture(earthColorMapTexture)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        earthColorMapTexture.image.src = "earth.jpg";</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        earthSpecularMapTexture = gl.createTexture();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        earthSpecularMapTexture.image = new Image();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        earthSpecularMapTexture.image.onload = function () {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            handleLoadedTexture(earthSpecularMapTexture)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        earthSpecularMapTexture.image.src = "earth-specular.gif";</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var mvMatrix = mat4.create();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var mvMatrixStack = [];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var pMatrix = mat4.create();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function mvPushMatrix() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var copy = mat4.create();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        mat4.set(mvMatrix, copy);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        mvMatrixStack.push(copy);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function mvPopMatrix() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (mvMatrixStack.length == 0) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            throw "Invalid popMatrix!";</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        mvMatrix = mvMatrixStack.pop();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function setMatrixUniforms() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.uniformMatrix4fv(shaderProgram.pMatrixUniform, false, pMatrix);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform, false, mvMatrix);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var normalMatrix = mat3.create();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        mat4.toInverseMat3(mvMatrix, normalMatrix);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        mat3.transpose(normalMatrix);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.uniformMatrix3fv(shaderProgram.nMatrixUniform, false, normalMatrix);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function degToRad(degrees) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        return degrees * Math.PI / 180;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var sphereVertexNormalBuffer;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var sphereVertexTextureCoordBuffer;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var sphereVertexPositionBuffer;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var sphereVertexIndexBuffer;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function initBuffers() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var latitudeBands = 30;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var longitudeBands = 30;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var radius = 13;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var vertexPositionData = [];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var normalData = [];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var textureCoordData = [];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        for (var latNumber=0; latNumber &lt;= latitudeBands; latNumber++) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var theta = latNumber * Math.PI / latitudeBands;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var sinTheta = Math.sin(theta);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var cosTheta = Math.cos(theta);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            for (var longNumber=0; longNumber &lt;= longitudeBands; longNumber++) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var phi = longNumber * 2 * Math.PI / longitudeBands;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var sinPhi = Math.sin(phi);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var cosPhi = Math.cos(phi);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var x = cosPhi * sinTheta;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var y = cosTheta;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var z = sinPhi * sinTheta;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var u = 1 - (longNumber / longitudeBands);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var v = 1 - (latNumber / latitudeBands);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                normalData.push(x);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                normalData.push(y);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                normalData.push(z);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                textureCoordData.push(u);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                textureCoordData.push(v);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                vertexPositionData.push(radius * x);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                vertexPositionData.push(radius * y);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                vertexPositionData.push(radius * z);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var indexData = [];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        for (var latNumber=0; latNumber &lt; latitudeBands; latNumber++) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            for (var longNumber=0; longNumber &lt; longitudeBands; longNumber++) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var first = (latNumber * (longitudeBands + 1)) + longNumber;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                var second = first + longitudeBands + 1;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                indexData.push(first);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                indexData.push(second);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                indexData.push(first + 1);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                indexData.push(second);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                indexData.push(second + 1);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                indexData.push(first + 1);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexNormalBuffer = gl.createBuffer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindBuffer(gl.ARRAY_BUFFER, sphereVertexNormalBuffer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(normalData), gl.STATIC_DRAW);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexNormalBuffer.itemSize = 3;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexNormalBuffer.numItems = normalData.length / 3;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexTextureCoordBuffer = gl.createBuffer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindBuffer(gl.ARRAY_BUFFER, sphereVertexTextureCoordBuffer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(textureCoordData), gl.STATIC_DRAW);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexTextureCoordBuffer.itemSize = 2;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexTextureCoordBuffer.numItems = textureCoordData.length / 2;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexPositionBuffer = gl.createBuffer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindBuffer(gl.ARRAY_BUFFER, sphereVertexPositionBuffer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertexPositionData), gl.STATIC_DRAW);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexPositionBuffer.itemSize = 3;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexPositionBuffer.numItems = vertexPositionData.length / 3;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexIndexBuffer = gl.createBuffer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, sphereVertexIndexBuffer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indexData), gl.STREAM_DRAW);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexIndexBuffer.itemSize = 1;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        sphereVertexIndexBuffer.numItems = indexData.length;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var earthAngle = 180;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function drawScene() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        mat4.perspective(45, gl.viewportWidth / gl.viewportHeight, 0.1, 100.0, pMatrix);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var useColorMap = document.getElementById("color-map").checked;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.uniform1i(shaderProgram.useColorMapUniform, useColorMap);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var useSpecularMap = document.getElementById("specular-map").checked;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.uniform1i(shaderProgram.useSpecularMapUniform, useSpecularMap);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var lighting = document.getElementById("lighting").checked;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.uniform1i(shaderProgram.useLightingUniform, lighting);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (lighting) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            gl.uniform3f(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                shaderProgram.ambientColorUniform,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("ambientR").value),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("ambientG").value),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("ambientB").value)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            gl.uniform3f(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                shaderProgram.pointLightingLocationUniform,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("lightPositionX").value),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("lightPositionY").value),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("lightPositionZ").value)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            gl.uniform3f(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                shaderProgram.pointLightingSpecularColorUniform,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("specularR").value),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("specularG").value),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("specularB").value)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            gl.uniform3f(</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                shaderProgram.pointLightingDiffuseColorUniform,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("diffuseR").value),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("diffuseG").value),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                parseFloat(document.getElementById("diffuseB").value)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        mat4.identity(mvMatrix);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        mat4.translate(mvMatrix, [0, 0, -40]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        mat4.rotate(mvMatrix, degToRad(23.4), [1, 0, -1]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        mat4.rotate(mvMatrix, degToRad(earthAngle), [0, 1, 0]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.activeTexture(gl.TEXTURE0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindTexture(gl.TEXTURE_2D, earthColorMapTexture);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.uniform1i(shaderProgram.colorMapSamplerUniform, 0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.activeTexture(gl.TEXTURE1);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindTexture(gl.TEXTURE_2D, earthSpecularMapTexture);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.uniform1i(shaderProgram.specularMapSamplerUniform, 1);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindBuffer(gl.ARRAY_BUFFER, sphereVertexPositionBuffer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, sphereVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindBuffer(gl.ARRAY_BUFFER, sphereVertexTextureCoordBuffer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.vertexAttribPointer(shaderProgram.textureCoordAttribute, sphereVertexTextureCoordBuffer.itemSize, gl.FLOAT, false, 0, 0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindBuffer(gl.ARRAY_BUFFER, sphereVertexNormalBuffer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.vertexAttribPointer(shaderProgram.vertexNormalAttribute, sphereVertexNormalBuffer.itemSize, gl.FLOAT, false, 0, 0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, sphereVertexIndexBuffer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        setMatrixUniforms();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.drawElements(gl.TRIANGLES, sphereVertexIndexBuffer.numItems, gl.UNSIGNED_SHORT, 0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    var lastTime = 0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function animate() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var timeNow = new Date().getTime();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        if (lastTime != 0) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var elapsed = timeNow - lastTime;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            earthAngle += 0.05 * elapsed;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        lastTime = timeNow;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function tick() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        requestAnimFrame(tick);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        drawScene();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        animate();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    function webGLStart() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var canvas = document.getElementById("lesson15-canvas");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        initGL(canvas);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        initShaders();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        initBuffers();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        initTextures();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.clearColor(0.0, 0.0, 0.0, 1.0);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        gl.enable(gl.DEPTH_TEST);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        tick();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/head&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;body <span class="webkit-html-attribute-name">onload</span>="<span class="webkit-html-attribute-value">webGLStart();</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;a <span class="webkit-html-attribute-name">href</span>="<a class="webkit-html-attribute-value webkit-html-external-link" target="_blank" href="http://learningwebgl.com/blog/?p=1778">http://learningwebgl.com/blog/?p=1778</a>"&gt;</span>&amp;lt;&amp;lt; Back to Lesson 15<span class="webkit-html-tag">&lt;/a&gt;</span><span class="webkit-html-tag">&lt;br /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;canvas <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">lesson15-canvas</span>" <span class="webkit-html-attribute-name">style</span>="<span class="webkit-html-attribute-value">border: none;</span>" <span class="webkit-html-attribute-name">width</span>="<span class="webkit-html-attribute-value">500</span>" <span class="webkit-html-attribute-name">height</span>="<span class="webkit-html-attribute-value">500</span>"&gt;</span><span class="webkit-html-tag">&lt;/canvas&gt;</span><span class="webkit-html-tag">&lt;br /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">checkbox</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">color-map</span>" <span class="webkit-html-attribute-name">checked</span> /&gt;</span> Use color map<span class="webkit-html-tag">&lt;br/&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">checkbox</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">specular-map</span>" <span class="webkit-html-attribute-name">checked</span> /&gt;</span> Use specular map<span class="webkit-html-tag">&lt;br/&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">checkbox</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">lighting</span>" <span class="webkit-html-attribute-name">checked</span> /&gt;</span> Use lighting<span class="webkit-html-tag">&lt;br/&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;h2&gt;</span>Point light:<span class="webkit-html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;table <span class="webkit-html-attribute-name">style</span>="<span class="webkit-html-attribute-value">border: 0; padding: 10px;</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;tr&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span><span class="webkit-html-tag">&lt;b&gt;</span>Location:<span class="webkit-html-tag">&lt;/b&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>X: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">lightPositionX</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">-10.0</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>Y: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">lightPositionY</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">4.0</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>Z: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">lightPositionZ</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">-20.0</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;/tr&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;tr&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span><span class="webkit-html-tag">&lt;b&gt;</span>Specular colour:<span class="webkit-html-tag">&lt;/b&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>R: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">specularR</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">5.0</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>G: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">specularG</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">5.0</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>B: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">specularB</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">5.0</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;/tr&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;tr&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span><span class="webkit-html-tag">&lt;b&gt;</span>Diffuse colour:<span class="webkit-html-tag">&lt;/b&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>R: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">diffuseR</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">0.8</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>G: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">diffuseG</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">0.8</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>B: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">diffuseB</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">0.8</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;/tr&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/table&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;h2&gt;</span>Ambient light:<span class="webkit-html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;table <span class="webkit-html-attribute-name">style</span>="<span class="webkit-html-attribute-value">border: 0; padding: 10px;</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;tr&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span><span class="webkit-html-tag">&lt;b&gt;</span>Colour:<span class="webkit-html-tag">&lt;/b&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>R: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">ambientR</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">0.4</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>G: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">ambientG</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">0.4</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            <span class="webkit-html-tag">&lt;td&gt;</span>B: <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">ambientB</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">0.4</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;/tr&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/table&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;br/&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    Earth texture courtesy of <span class="webkit-html-tag">&lt;a <span class="webkit-html-attribute-name">href</span>="<a class="webkit-html-attribute-value webkit-html-external-link" target="_blank" href="http://www.esa.int/esaEO/SEMGSY2IU7E_index_0.html">http://www.esa.int/esaEO/SEMGSY2IU7E_index_0.html</a>"&gt;</span>the European Space Agency/Envisat<span class="webkit-html-tag">&lt;/a&gt;</span>.<span class="webkit-html-tag">&lt;br/&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;br/&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;a <span class="webkit-html-attribute-name">href</span>="<a class="webkit-html-attribute-value webkit-html-external-link" target="_blank" href="http://learningwebgl.com/blog/?p=1778">http://learningwebgl.com/blog/?p=1778</a>"&gt;</span>&amp;lt;&amp;lt; Back to Lesson 15<span class="webkit-html-tag">&lt;/a&gt;</span><span class="webkit-html-tag">&lt;br /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-comment">&lt;!-- Google Analytics stuff, please ignore - nothing to do with WebGL :-) --&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/javascript</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/javascript</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        try {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var pageTracker = _gat._getTracker("UA-2240015-5");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            pageTracker._trackPageview();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        } catch(err) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/body&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"></td></tr></tbody></table></body></html>