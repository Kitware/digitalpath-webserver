<!DOCTYPE html>

<html> 
 
<head> 


<title>Connectome Viewer</title> 

<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"> 

<link type="text/css" href="js/css/ui-lightness/jquery-ui-1.8.22.custom.css" rel="stylesheet" />
<script type="text/javascript" src="js/js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/js/jquery-ui-1.8.22.custom.min.js"></script>
<script type="text/javascript" src="glMatrix-0.9.5.min.js"></script>
<script type="text/javascript" src="webgl-utils.js"></script>
<script type="text/javascript" src="init.js"></script>
<script type="text/javascript" src="camera.js"></script>
<script type="text/javascript" src="view.js"></script>
<script type="text/javascript" src="tile.js"></script>
<script type="text/javascript" src="cache.js"></script>
<script type="text/javascript" src="viewer.js"></script>
<script type="text/javascript" src="eventManager.js"></script>

<script type="text/javascript">
  // These globals are used in the viewer javascript.  I need to get rid of them.	
  var origin = [9663763, 7643791.5, 0];
  var spacing = [226.17269405242, 227.53127170139, 0];
</script>

<script id="shader-poly-fs" type="x-shader/x-fragment">
  precision mediump float;
  uniform vec3 uColor;
  void main(void) {
   gl_FragColor = vec4(uColor, 1.0);
   //gl_FragColor = vec4(0.5, 0.0, 0.0, 1.0);
  }
</script>
<script id="shader-poly-vs" type="x-shader/x-vertex">
  attribute vec3 aVertexPosition;
  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;
  void main(void) {
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
  }
</script>
<script id="shader-tile-fs" type="x-shader/x-fragment"> 
  #ifdef GL_ES
  precision highp float;
  #endif

  uniform sampler2D uSampler;
  varying vec2 vTextureCoord;
 
  void main(void) {
    gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
  }
</script>  
<script id="shader-tile-vs" type="x-shader/x-vertex"> 
  attribute vec3 aVertexPosition;
  attribute vec2 aTextureCoord;

  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;
  uniform mat3 uNMatrix;
  varying vec2 vTextureCoord;

  void main(void) {
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
    vTextureCoord = aTextureCoord;
  }
</script> 
<script id="shader-text-fs" type="x-shader/x-fragment">
  precision mediump float;

  varying vec2 vTextureCoord;
  uniform sampler2D uSampler;
  uniform vec3 uColor;

  void main(void) {
    vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
    // Use the image pixel value as transparency.
    gl_FragColor = vec4(uColor, textureColor.rgb[0]);
  }
</script>
<script id="shader-text-vs" type="x-shader/x-vertex">
  attribute vec3 aVertexPosition;
  attribute vec2 aTextureCoord;

  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;

  varying vec2 vTextureCoord;
  void main(void) {
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
    vTextureCoord = aTextureCoord;
  }
</script>
<script type="text/javascript"> 
 

  var CANVAS;
  var EVENT_MANAGER;
  var VIEWER1;

  function initViews() {
    var source1 = new Cache("http://localhost:81/tile.php?image="+"4ecb20134834a302ac000001"+"&name=");
    VIEWER1 = new Viewer([0,0, CANVAS.width,CANVAS.height], source1);
    
      VIEWER1.MainView.Camera.Height = 16384;
      VIEWER1.MainView.Camera.FocalPoint[0] = 8428.65777;
      VIEWER1.MainView.Camera.FocalPoint[1] = 8009.9555;
      VIEWER1.MainView.Camera.FocalPoint[2] = 10;
      VIEWER1.MainView.Camera.ComputeMatrix();
      VIEWER1.OverView.Camera.ComputeMatrix();
      
    EVENT_MANAGER = new EventManager(CANVAS);
    EVENT_MANAGER.AddViewer(VIEWER1); 
  }

  function draw() {
    GL.clear(GL.COLOR_BUFFER_BIT | GL.DEPTH_BUFFER_BIT);
    // This just changes the camera based on the current time.
    VIEWER1.Animate();
    VIEWER1.Draw();	
  }

  function handleMouseDown(event) {EVENT_MANAGER.HandleMouseDown(event);}
  function handleMouseUp(event) {EVENT_MANAGER.HandleMouseUp(event);}
  function handleMouseMove(event) {EVENT_MANAGER.HandleMouseMove(event);}
  function handleKeyDown(event) {EVENT_MANAGER.HandleKeyDown(event);}
  function handleKeyUp(event) {EVENT_MANAGER.HandleKeyUp(event);}

  function webGLStart() {
    CANVAS = document.getElementById("viewer-canvas");
    initGL(CANVAS);
    initViews();
    initShaderPrograms();
    initOutlineBuffers();
    initImageTileBuffers();

    GL.clearColor(0.9, 0.9, 0.9, 1.0);
    GL.enable(GL.DEPTH_TEST);

    CANVAS.onmousedown = handleMouseDown;
    document.onmouseup = handleMouseUp;
    document.onmousemove = handleMouseMove;

    document.onkeydown = handleKeyDown;
    document.onkeyup = handleKeyUp;

    eventuallyRender();
  }


 
 
  function zoomIn() {
    VIEWER1.AnimateZoom(0.5);
  }
  
  function zoomOut() {
    VIEWER1.AnimateZoom(2.0);
  }
  
  function rotateRight() {
    VIEWER1.AnimateRoll(-12.0); // degrees
  }
  
  function rotateLeft() {
    VIEWER1.AnimateRoll(12.0); // degrees
  }

</script> 
 
</head> 
 
 
<body onload="webGLStart();">
  <canvas id="viewer-canvas" style="border: none;" width="1000" height="500"></canvas>
  </br>
  <table border="1" id="rotatebuttons" >
    <tr>
      <td type="button" onclick="zoomIn();" style="width:20px;height:20px;background-color:white;text-align:center;" >+</td>
      <td type="button" onclick="zoomOut();" style="width:20px;height:20px;background-color:white;text-align:center;" >-</td>
      <td type="button" onclick="rotateRight();" style="width:20px;height:20px;background-color:white;text-align:center;" >R</td>
      <td type="button" onclick="rotateLeft();" style="width:20px;height:20px;background-color:white;text-align:center;" >L</td>
    </tr>
  </table>
 </body> 
 
</html> 
